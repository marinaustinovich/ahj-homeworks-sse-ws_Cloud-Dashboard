(()=>{var t={484:function(t){t.exports=function(){"use strict";var t=1e3,e=6e4,n=36e5,s="millisecond",i="second",r="minute",a="hour",o="day",c="week",d="month",u="quarter",h="year",l="date",f="Invalid Date",$=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},g=function(t,e,n){var s=String(t);return!s||s.length>=e?t:""+Array(e+1-s.length).join(n)+t},m={s:g,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),s=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+g(s,2,"0")+":"+g(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var s=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(s,d),r=n-i<0,a=e.clone().add(s+(r?-1:1),d);return+(-(s+(n-i)/(r?i-a:a-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:d,y:h,w:c,d:o,D:l,h:a,m:r,s:i,ms:s,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},w="en",y={};y[w]=p;var M=function(t){return t instanceof E},S=function t(e,n,s){var i;if(!e)return w;if("string"==typeof e){var r=e.toLowerCase();y[r]&&(i=r),n&&(y[r]=n,i=r);var a=e.split("-");if(!i&&a.length>1)return t(a[0])}else{var o=e.name;y[o]=e,i=o}return!s&&i&&(w=i),i||!s&&w},b=function(t,e){if(M(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new E(n)},L=m;L.l=S,L.i=M,L.w=function(t,e){return b(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var E=function(){function p(t){this.$L=S(t.locale,null,!0),this.parse(t)}var g=p.prototype;return g.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(L.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var s=e.match($);if(s){var i=s[2]-1||0,r=(s[7]||"0").substring(0,3);return n?new Date(Date.UTC(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)):new Date(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},g.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},g.$utils=function(){return L},g.isValid=function(){return!(this.$d.toString()===f)},g.isSame=function(t,e){var n=b(t);return this.startOf(e)<=n&&n<=this.endOf(e)},g.isAfter=function(t,e){return b(t)<this.startOf(e)},g.isBefore=function(t,e){return this.endOf(e)<b(t)},g.$g=function(t,e,n){return L.u(t)?this[e]:this.set(n,t)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(t,e){var n=this,s=!!L.u(e)||e,u=L.p(t),f=function(t,e){var i=L.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return s?i:i.endOf(o)},$=function(t,e){return L.w(n.toDate()[t].apply(n.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},v=this.$W,p=this.$M,g=this.$D,m="set"+(this.$u?"UTC":"");switch(u){case h:return s?f(1,0):f(31,11);case d:return s?f(1,p):f(0,p+1);case c:var w=this.$locale().weekStart||0,y=(v<w?v+7:v)-w;return f(s?g-y:g+(6-y),p);case o:case l:return $(m+"Hours",0);case a:return $(m+"Minutes",1);case r:return $(m+"Seconds",2);case i:return $(m+"Milliseconds",3);default:return this.clone()}},g.endOf=function(t){return this.startOf(t,!1)},g.$set=function(t,e){var n,c=L.p(t),u="set"+(this.$u?"UTC":""),f=(n={},n[o]=u+"Date",n[l]=u+"Date",n[d]=u+"Month",n[h]=u+"FullYear",n[a]=u+"Hours",n[r]=u+"Minutes",n[i]=u+"Seconds",n[s]=u+"Milliseconds",n)[c],$=c===o?this.$D+(e-this.$W):e;if(c===d||c===h){var v=this.clone().set(l,1);v.$d[f]($),v.init(),this.$d=v.set(l,Math.min(this.$D,v.daysInMonth())).$d}else f&&this.$d[f]($);return this.init(),this},g.set=function(t,e){return this.clone().$set(t,e)},g.get=function(t){return this[L.p(t)]()},g.add=function(s,u){var l,f=this;s=Number(s);var $=L.p(u),v=function(t){var e=b(f);return L.w(e.date(e.date()+Math.round(t*s)),f)};if($===d)return this.set(d,this.$M+s);if($===h)return this.set(h,this.$y+s);if($===o)return v(1);if($===c)return v(7);var p=(l={},l[r]=e,l[a]=n,l[i]=t,l)[$]||1,g=this.$d.getTime()+s*p;return L.w(g,this)},g.subtract=function(t,e){return this.add(-1*t,e)},g.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var s=t||"YYYY-MM-DDTHH:mm:ssZ",i=L.z(this),r=this.$H,a=this.$m,o=this.$M,c=n.weekdays,d=n.months,u=function(t,n,i,r){return t&&(t[n]||t(e,s))||i[n].slice(0,r)},h=function(t){return L.s(r%12||12,t,"0")},l=n.meridiem||function(t,e,n){var s=t<12?"AM":"PM";return n?s.toLowerCase():s},$={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:L.s(o+1,2,"0"),MMM:u(n.monthsShort,o,d,3),MMMM:u(d,o),D:this.$D,DD:L.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,c,2),ddd:u(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(r),HH:L.s(r,2,"0"),h:h(1),hh:h(2),a:l(r,a,!0),A:l(r,a,!1),m:String(a),mm:L.s(a,2,"0"),s:String(this.$s),ss:L.s(this.$s,2,"0"),SSS:L.s(this.$ms,3,"0"),Z:i};return s.replace(v,(function(t,e){return e||$[t]||i.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(s,l,f){var $,v=L.p(l),p=b(s),g=(p.utcOffset()-this.utcOffset())*e,m=this-p,w=L.m(this,p);return w=($={},$[h]=w/12,$[d]=w,$[u]=w/3,$[c]=(m-g)/6048e5,$[o]=(m-g)/864e5,$[a]=m/n,$[r]=m/e,$[i]=m/t,$)[v]||m,f?w:L.a(w)},g.daysInMonth=function(){return this.endOf(d).$D},g.$locale=function(){return y[this.$L]},g.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),s=S(t,e,!0);return s&&(n.$L=s),n},g.clone=function(){return L.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},p}(),k=E.prototype;return b.prototype=k,[["$ms",s],["$s",i],["$m",r],["$H",a],["$W",o],["$M",d],["$y",h],["$D",l]].forEach((function(t){k[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),b.extend=function(t,e){return t.$i||(t(e,E,b),t.$i=!0),b},b.locale=S,b.isDayjs=M,b.unix=function(t){return b(1e3*t)},b.en=y[w],b.Ls=y,b.p={},b}()}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=async t=>{const{method:e,path:n,data:s,headers:i={"Content-Type":"application/json"}}=t,r=`https://cloud-dachboard.onrender.com${n}`;return(await fetch(r,{method:e,headers:i,body:JSON.stringify(s)})).json()};class e{static list(){return t({method:"GET",path:"/"})}static create(){return t({method:"POST",path:"/"})}static delete(e){return t({method:"DELETE",path:`/${e}`})}static subscribeOnServerEvents(t){const e=new EventSource("https://cloud-dachboard.onrender.com/sse");return e.onmessage=e=>{const n=JSON.parse(e.data);t(n)},e.onerror=t=>{console.error("EventSource failed:",t),e.close()},e}}class s{constructor(t,e){this.data=t,this.ws=e,this.instance=document.createElement("li"),this.init(),this.registerWebSocketListeners()}init(){this.instance.classList.add("instance-item"),this.updateUI()}updateUI(){const t="running"===this.data.state?"status-icon-running":"status-icon-stop";this.instance.innerHTML=`\n      <span class="instance-name">${this.data.id}</span>\n      <div class="status">\n        <span class="status-title">Status:</span>\n        <span class=${t}>${this.data.state}</span>\n      </div>\n      <div class="actions">\n        <span class="status-title">Actions:</span>\n        <button class="instance-start" aria-label="start instance" ${"running"===this.data.state?'style="display:none;"':""}>â–¶</button>\n        <button class="instance-stop" aria-label="stop instance" ${"stopped"===this.data.state?'style="display:none;"':""}>&#9208</button>\n        <button class="instance-close" aria-label="close instance">&#10006;</button>\n      </div>\n    `,this.registerEvents()}registerEvents(){const t=this.instance.querySelector(".instance-start"),e=this.instance.querySelector(".instance-stop"),n=this.instance.querySelector(".instance-close");t.addEventListener("click",(async()=>this.sendMessage("start"))),e.addEventListener("click",(async()=>this.sendMessage("stop"))),n.addEventListener("click",(async()=>this.close()))}sendMessage(t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({id:this.data.id,action:t}))}registerWebSocketListeners(){this.ws&&this.ws.addEventListener("message",(t=>{const e=JSON.parse(t.data);e.id===this.data.id&&(this.data=e,this.updateUI())}))}updateData(t){this.data=t,this.updateUI()}async close(){try{await e.delete(this.data.id)}catch(t){console.error("Error deleting instance:",t)}}markup(){return this.instance}}var i=n(484),r=n.n(i);class a{constructor(t,e){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t,this.data=e,this.worklog=document.createElement("div"),this.drawUi()}drawUi(){this.worklog.classList.add("worklog-item");const t="Create command"===this.data.info,e=t?r()(this.data.timeStamp).format("HH:mm:ss DD.MM.YY"):this.data.timeStamp,n=t?"Received":"";this.worklog.innerHTML=`\n      <div class="worklog-timestamp">${e}</div>\n      <div class="worklog-name">Server: ${this.data.id}</div>\n      <div class="worklog-info">INFO: ${n} ${this.data.info}</div>\n      `,this.container.querySelector(".worklog-list").append(this.worklog)}}class o{constructor(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t,this.instances=[],this.instanceListWidget=null,this.instanceObjects=[],this.websocket=null}init(){this.drawUi(),this.events(),this.onEnterChatHandler(),this.subscribeToServerEvents()}async drawUi(){this.instanceListWidget=document.createElement("div"),this.instanceListWidget.classList.add("instances-widget"),this.instanceListWidget.innerHTML='\n      <h3>Your micro instances</h3>\n      <ul class="instances-list"></ul>\n      <button class="add-instance" aria-label="Create new instance">Create new instance</button>\n    ',this.list=this.instanceListWidget.querySelector(".instances-list"),this.renderInstanceList(),this.container.append(this.instanceListWidget)}events(){this.instanceListWidget.querySelector(".add-instance").addEventListener("click",(()=>o.createInstance()))}static async createInstance(){try{await e.create()}catch(t){console.error("Error creating new instance:",t)}}subscribeToServerEvents(){e.subscribeOnServerEvents((t=>{const e=new a(this.container,t);this.activeWorklog=e,"Create command"!==t.info&&this.renderInstanceList()}))}onEnterChatHandler(){this.websocket=new WebSocket("wss://cloud-dachboard.onrender.com"),this.subscribeOnEvents()}subscribeOnEvents(){this.websocket.addEventListener("open",(()=>o.handleOpen())),this.websocket.addEventListener("message",(t=>o.handleMessage(t))),this.websocket.addEventListener("close",(()=>o.handleClose())),this.websocket.addEventListener("error",(t=>o.handleError(t)))}static handleOpen(){console.log("Connected to WebSocket server")}static handleClose(){console.log("Disconnected from WebSocket server")}static handleError(t){console.error(`Error: ${t}`)}static handleMessage(t){console.log(t.data)}async renderInstanceList(){this.list.innerHTML="";const{data:t}=await e.list();this.instances=t,this.instances.length>0&&this.instances.forEach((t=>this.addInstance(t)))}addInstance(t){const e=new s(t,this.websocket);this.instanceObjects.push(e),this.list.appendChild(e.markup())}}const c=document.querySelector(".cloud-container"),d=new o(c),u=new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t,this.worklogList=null}init(){this.worklogList=document.createElement("div"),this.worklogList.classList.add("worklog-widget"),this.worklogList.innerHTML='\n        <h3>Worklog:</h3>\n        <div class="worklog-list"></div>\n      ',this.container.append(this.worklogList)}}(c);d.init(),u.init()})()})();
//# sourceMappingURL=main.js.map